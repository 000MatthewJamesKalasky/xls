
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://google.github.io/xls/floating_point/">
      
      
        <link rel="prev" href="../dslx_std/">
      
      
        <link rel="next" href="../fuzzer/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>Floating Point - XLS: Accelerated HW Synthesis</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#floating-point-routines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="XLS: Accelerated HW Synthesis" class="md-header__button md-logo" aria-label="XLS: Accelerated HW Synthesis" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            XLS: Accelerated HW Synthesis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Floating Point
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/google/xls/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="XLS: Accelerated HW Synthesis" class="md-nav__button md-logo" aria-label="XLS: Accelerated HW Synthesis" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    XLS: Accelerated HW Synthesis
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/google/xls/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          DSLX
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          DSLX
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/hello_xls/" class="md-nav__link">
        Hello, XLS!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/float_to_int/" class="md-nav__link">
        Basic logic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/intro_to_parametrics/" class="md-nav__link">
        Intro to parameterics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/crc32/" class="md-nav__link">
        For expressions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/prefix_scan/" class="md-nav__link">
        Enumerate and match
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/intro_to_procs/" class="md-nav__link">
        Intro to Procs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          XLS[cc]
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          XLS[cc]
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/xlscc_overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/xlscc_integers/" class="md-nav__link">
        Integers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/xlscc_channels/" class="md-nav__link">
        Channels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/xlscc_memory/" class="md-nav__link">
        Memory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/xlscc_state/" class="md-nav__link">
        State
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/xlscc_pipelined_loops/" class="md-nav__link">
        Pipelined Loops
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          IR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          IR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ir_overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ir_semantics/" class="md-nav__link">
        Semantics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../optimizations/optimizations/" class="md-nav__link">
        Optimizations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Scheduling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Scheduling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scheduling/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../delay_estimation/" class="md-nav__link">
        Delay Estimation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ir_visualization/" class="md-nav__link">
        Visualizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Native JIT
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Native JIT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ir_jit/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_layout/" class="md-nav__link">
        Data Layout
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../solvers/" class="md-nav__link">
        Formal
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          DSLX
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          DSLX
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dslx_reference/" class="md-nav__link">
        Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dslx_std/" class="md-nav__link">
        Standard Library
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Floating Point
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Floating Point
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#apfloat" class="md-nav__link">
    APFloat
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-operations" class="md-nav__link">
    Supported operations
  </a>
  
    <nav class="md-nav" aria-label="Supported operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apfloattag" class="md-nav__link">
    apfloat::tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatqnan" class="md-nav__link">
    apfloat::qnan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatzero" class="md-nav__link">
    apfloat::zero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatone" class="md-nav__link">
    apfloat::one
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatinf" class="md-nav__link">
    apfloat::inf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatunbiased_exponent" class="md-nav__link">
    apfloat::unbiased_exponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatbias" class="md-nav__link">
    apfloat::bias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatflatten" class="md-nav__link">
    apfloat::flatten
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatunflatten" class="md-nav__link">
    apfloat::unflatten
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatcast_from_fixed" class="md-nav__link">
    apfloat::cast_from_fixed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatnormalize" class="md-nav__link">
    apfloat::normalize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatis_inf" class="md-nav__link">
    apfloat::is_inf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatis_nan" class="md-nav__link">
    apfloat::is_nan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatis_zero_or_subnormal" class="md-nav__link">
    apfloat::is_zero_or_subnormal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatcast_to_fixed" class="md-nav__link">
    apfloat::cast_to_fixed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloateq_2" class="md-nav__link">
    apfloat::eq_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatgt_2" class="md-nav__link">
    apfloat::gt_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatgte_2" class="md-nav__link">
    apfloat::gte_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatlte_2" class="md-nav__link">
    apfloat::lte_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatlt_2" class="md-nav__link">
    apfloat::lt_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatround_towards_zero" class="md-nav__link">
    apfloat::round_towards_zero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatto_int" class="md-nav__link">
    apfloat::to_int
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloataddsub" class="md-nav__link">
    apfloat::add/sub
  </a>
  
    <nav class="md-nav" aria-label="apfloat::add/sub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    Implementation details
  </a>
  
    <nav class="md-nav" aria-label="Implementation details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#result-sign-determination" class="md-nav__link">
    Result sign determination
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rounding" class="md-nav__link">
    Rounding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatmul" class="md-nav__link">
    apfloat::mul
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatfma" class="md-nav__link">
    apfloat::fma
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#float64" class="md-nav__link">
    float64
  </a>
  
    <nav class="md-nav" aria-label="float64">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#float64to_int64" class="md-nav__link">
    float64::to_int64
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#float32" class="md-nav__link">
    float32
  </a>
  
    <nav class="md-nav" aria-label="float32">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#float32to_int32-float32from_int32" class="md-nav__link">
    float32::to_int32, float32::from_int32
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fuzzer/" class="md-nav__link">
        Fuzzer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dslx_bytecode_interpreter/" class="md-nav__link">
        Interpreter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dslx_language_server/" class="md-nav__link">
        Language Server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Code Generation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Code Generation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../codegen_options/" class="md-nav__link">
        Codegen Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ir_lowering/" class="md-nav__link">
        IR Lowering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vast/" class="md-nav__link">
        VAST
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build_system/" class="md-nav__link">
        Build System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bazel_rules_macros/" class="md-nav__link">
        Bazel Rules And Macros
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools_quick_start/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        Listing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../interpreters/" class="md-nav__link">
        Interpreters
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../xls_style/" class="md-nav__link">
        Style Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../adding_ir_operation/" class="md-nav__link">
        Adding a new IR operation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ideas_and_projects/" class="md-nav__link">
        Ideas and Projects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fpga_characterization/" class="md-nav__link">
        FPGA characterization (experimental)
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
      
      
      
        <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
          Design Docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_6">
          <span class="md-nav__icon md-icon"></span>
          Design Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../design_docs/legalize_multiple_channel_ops_per_channel/" class="md-nav__link">
        Legalize Multiple Channel Ops Per Channel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../design_docs/proc_scoped_channels/" class="md-nav__link">
        Proc-scoped channels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          NoC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          NoC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_readme/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
      
      
      
        <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
          Topologies
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8_2">
          <span class="md-nav__icon md-icon"></span>
          Topologies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_topologies/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_dimension_order_topology/" class="md-nav__link">
        Dimension Order
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_tree_topology/" class="md-nav__link">
        Tree
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_butterfly_topology/" class="md-nav__link">
        k-ary n-fly Butterfly
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_fully_connected_topology/" class="md-nav__link">
        Fully Connected
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_star_topology/" class="md-nav__link">
        Star
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../noc/xls_noc_glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#apfloat" class="md-nav__link">
    APFloat
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-operations" class="md-nav__link">
    Supported operations
  </a>
  
    <nav class="md-nav" aria-label="Supported operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apfloattag" class="md-nav__link">
    apfloat::tag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatqnan" class="md-nav__link">
    apfloat::qnan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatzero" class="md-nav__link">
    apfloat::zero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatone" class="md-nav__link">
    apfloat::one
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatinf" class="md-nav__link">
    apfloat::inf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatunbiased_exponent" class="md-nav__link">
    apfloat::unbiased_exponent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatbias" class="md-nav__link">
    apfloat::bias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatflatten" class="md-nav__link">
    apfloat::flatten
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatunflatten" class="md-nav__link">
    apfloat::unflatten
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatcast_from_fixed" class="md-nav__link">
    apfloat::cast_from_fixed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatnormalize" class="md-nav__link">
    apfloat::normalize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatis_inf" class="md-nav__link">
    apfloat::is_inf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatis_nan" class="md-nav__link">
    apfloat::is_nan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatis_zero_or_subnormal" class="md-nav__link">
    apfloat::is_zero_or_subnormal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatcast_to_fixed" class="md-nav__link">
    apfloat::cast_to_fixed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloateq_2" class="md-nav__link">
    apfloat::eq_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatgt_2" class="md-nav__link">
    apfloat::gt_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatgte_2" class="md-nav__link">
    apfloat::gte_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatlte_2" class="md-nav__link">
    apfloat::lte_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatlt_2" class="md-nav__link">
    apfloat::lt_2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatround_towards_zero" class="md-nav__link">
    apfloat::round_towards_zero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatto_int" class="md-nav__link">
    apfloat::to_int
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloataddsub" class="md-nav__link">
    apfloat::add/sub
  </a>
  
    <nav class="md-nav" aria-label="apfloat::add/sub">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    Implementation details
  </a>
  
    <nav class="md-nav" aria-label="Implementation details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#result-sign-determination" class="md-nav__link">
    Result sign determination
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rounding" class="md-nav__link">
    Rounding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatmul" class="md-nav__link">
    apfloat::mul
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apfloatfma" class="md-nav__link">
    apfloat::fma
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#float64" class="md-nav__link">
    float64
  </a>
  
    <nav class="md-nav" aria-label="float64">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#float64to_int64" class="md-nav__link">
    float64::to_int64
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#float32" class="md-nav__link">
    float32
  </a>
  
    <nav class="md-nav" aria-label="float32">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#float32to_int32-float32from_int32" class="md-nav__link">
    float32::to_int32, float32::from_int32
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="floating-point-routines">Floating-point routines</h1>
<p>XLS provides implementations of several floating-point operations and may add
more at any time. Here are listed notable details of our implementations or of
floating-point operations in general. Unless otherwise specified, not possible
or out-of-scope, all operations and types should be IEEE-754 compliant.</p>
<p>For example, floating-point exceptions have not been implemented; they're
outside our current scope. The numeric results of multiplication, on the other
hand, should <em>exactly</em> match those of any other compliant implementation.</p>
<h2 id="apfloat">APFloat</h2>
<p>Floating-point operations are, in general, defined by the same sequence of steps
regardless of their underlying bit widths: fractional parts must be expanded
then aligned, then an operation (add, multiply, etc.) must be performed,
interpreting the fractions as integral types, followed by rounding, special case
handling, and reconstructing an output FP type.</p>
<p>This observation leads to the possibility of <em>generic</em> floating-point routines:
a fully parameterized add, for example, which can be instantiated with and 8-bit
exponent and 23-bit fractional part for binary32 types, and an 11-bit exponent
and 52-bit fractional part for binary64 types. Even more interesting, a
hypothetical bfloat32 type could <em>immediately</em> be supported by, say,
instantiating that adder with, say, 15 exponent bits and 16 fractional ones.</p>
<p>As much as possible, XLS implements FP operations in terms of its
<a href="https://github.com/google/xls/tree/main/xls/dslx/stdlib/apfloat.x"><code>APFloat</code></a>
(arbitrary-precision floating-point) type. <code>APFloat</code> is a parameterized
floating-point structure with a fixed one-bit sign and specifiable exponent and
fractional part size. For ease of use, common types, such as
<a href="https://github.com/google/xls/tree/main/xls/dslx/stdlib/float32.x"><code>float32</code></a>, are
defined in terms of those <code>APFloat</code> types.</p>
<p>For example, the generic "is X infinite" operation is defined in <code>apfloat.x</code> as:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Returns whether or not the given APFloat represents an infinite quantity.</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">is_inf</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">bexp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">std</span>::<span class="n">mask_bits</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">fraction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">bits</span><span class="p">[</span><span class="n">FRACTION_SZ</span><span class="p">]</span>:<span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Whereas in <code>float32.x</code>, <code>F32</code> is defined as:</p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">F32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apfloat</span>::<span class="n">APFloat</span><span class="o">&lt;</span><span class="kt">u32</span>:<span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span>:<span class="mi">23</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>and <code>is_inf</code> is exposed as:</p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">is_inf</span><span class="p">(</span><span class="n">f</span>: <span class="nc">F32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">apfloat</span>::<span class="n">is_inf</span><span class="o">&lt;</span><span class="kt">u32</span>:<span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="kt">u32</span>:<span class="mi">23</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>In this way, users can refer to <code>F32</code> types and can use them as and with
<code>float32::is_inf(f)</code>, giving them simplified access to a generic operation.</p>
<h2 id="supported-operations">Supported operations</h2>
<p>Here are listed the routines so far implemented in XLS. Unless otherwise
specified, operations are implemented in terms of <code>APFloat</code>s such that they can
support any precisions (aside from corner cases, such as a zero-byte fractional
part).</p>
<h3 id="apfloattag"><code>apfloat::tag</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">tag</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">input_float</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">APFloatTag</span>
</code></pre></div>
<p>Returns the type of float as one of <code>APFloatTag::ZERO</code>, <code>APFloatTag::SUBNORMAL</code>,
<code>APFloatTag::INFINITY</code>, <code>APFloatTag::NAN</code> and <code>APFloatTag::NORMAL</code>.</p>
<h3 id="apfloatqnan"><code>apfloat::qnan</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">qnan</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns a <a href="https://en.wikipedia.org/wiki/NaN#Quiet_NaN"><code>quiet NaN</code></a>.</p>
<h3 id="apfloatzero"><code>apfloat::zero</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">zero</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sign</span>: <span class="nc">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns a positive or negative zero depending upon the given sign parameter.</p>
<h3 id="apfloatone"><code>apfloat::one</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">one</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sign</span>: <span class="nc">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns one or minus one depending upon the given sign parameter.</p>
<h3 id="apfloatinf"><code>apfloat::inf</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">inf</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sign</span>: <span class="nc">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns a positive or a negative infinity depending upon the given sign
parameter.</p>
<h3 id="apfloatunbiased_exponent"><code>apfloat::unbiased_exponent</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">unbiased_exponent</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">sN</span><span class="p">[</span><span class="n">EXP_SZ</span><span class="p">]</span>
</code></pre></div>
<p>Returns the unbiased exponent. For normal numbers it is <code>bexp - 2^EXP_SZ +
1``and for subnormals it is,</code>2 - 2^EXP_SZ<code>. For infinity and `NaN</code>, there are
no guarantees, as the unbiased exponent has no meaning in that case.</p>
<p>For example, for single precision normal numbers the unbiased exponent is
<code>bexp - 127``and for subnormal numbers it is</code>-126`.</p>
<h3 id="apfloatbias"><code>apfloat::bias</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">bias</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">unbiased_exponent</span>: <span class="nc">sN</span><span class="p">[</span><span class="n">EXP_SZ</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">bits</span><span class="p">[</span><span class="n">EXP_SZ</span><span class="p">]</span>
</code></pre></div>
<p>Returns the biased exponent which is equal to <code>unbiased_exponent + 2^EXP_SZ - 1</code></p>
<p>Since the function only takes as input the unbiased exponent, it cannot
distinguish between normal and subnormal numbers, as a result it assumes that
the input is the exponent for a normal number.</p>
<h3 id="apfloatflatten"><code>apfloat::flatten</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">flatten</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="p">,</span>
<span class="w">               </span><span class="n">TOTAL_SZ</span>:<span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="kt">u32</span>:<span class="mi">1</span><span class="o">+</span><span class="n">EXP_SZ</span><span class="o">+</span><span class="n">FRACTION_SZ</span><span class="p">}</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">               </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span>-&gt; <span class="nc">bits</span><span class="p">[</span><span class="n">TOTAL_SZ</span><span class="p">]</span>
</code></pre></div>
<p>Returns a bit string of size <code>1 + EXP_SZ + FRACTION_SZ</code> where the first bit is
the sign bit, the next <code>EXP_SZ</code> bit encode the biased exponent and the last
<code>FRACTION_SZ</code> are the significand without the hidden bit.</p>
<h3 id="apfloatunflatten"><code>apfloat::unflatten</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">unflatten</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="p">,</span>
<span class="w">                 </span><span class="n">TOTAL_SZ</span>:<span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="kt">u32</span>:<span class="mi">1</span><span class="o">+</span><span class="n">EXP_SZ</span><span class="o">+</span><span class="n">FRACTION_SZ</span><span class="p">}</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">bits</span><span class="p">[</span><span class="n">TOTAL_SZ</span><span class="p">])</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns a <code>APFloat</code> struct whose flattened version would be the input string
<code>x</code>.</p>
<h3 id="apfloatcast_from_fixed"><code>apfloat::cast_from_fixed</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">cast_from_fixed</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">NUM_SRC_BITS</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                       </span><span class="n">to_cast</span>: <span class="nc">sN</span><span class="p">[</span><span class="n">NUM_SRC_BITS</span><span class="p">])</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</code></pre></div>
<p>Casts the fixed point number to a floating point number using RNE (Round to
Nearest Even) as the rounding mode.</p>
<h3 id="apfloatnormalize"><code>apfloat::normalize</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">normalize</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="p">,</span>
<span class="w">                 </span><span class="n">WIDE_FRACTION</span>:<span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">FRACTION_SZ</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">u32</span>:<span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                 </span><span class="n">sign</span>: <span class="nc">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">exp</span>: <span class="nc">bits</span><span class="p">[</span><span class="n">EXP_SZ</span><span class="p">],</span>
<span class="w">                 </span><span class="n">fraction_with_hidden</span>: <span class="nc">bits</span><span class="p">[</span><span class="n">WIDE_FRACTION</span><span class="p">])</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns a normalized APFloat with the given components. <code>fraction_with_hidden</code>
is the fraction (including the hidden bit). This function only normalizes in the
direction of decreasing the exponent. Input must be a normal number or zero.
Subnormals/Denormals are flushed to zero in the result.</p>
<h3 id="apfloatis_inf"><code>apfloat::is_inf</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">is_inf</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns whether or not the given <code>APFloat</code> represents an infinite quantity.</p>
<h3 id="apfloatis_nan"><code>apfloat::is_nan</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">is_nan</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns whether or not the given <code>APFloat</code> represents <code>NaN</code>.</p>
<h3 id="apfloatis_zero_or_subnormal"><code>apfloat::is_zero_or_subnormal</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">is_zero_or_subnormal</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                            </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns <code>true</code> if <code>x == 0</code> or <code>x</code> is a subnormal number.</p>
<h3 id="apfloatcast_to_fixed"><code>apfloat::cast_to_fixed</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">cast_to_fixed</span><span class="o">&lt;</span><span class="n">NUM_DST_BITS</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                     </span><span class="n">to_cast</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span>-&gt; <span class="nc">sN</span><span class="p">[</span><span class="n">NUM_DST_BITS</span><span class="p">]</span>
</code></pre></div>
<p>Casts the floating point number to a fixed point number. Unrepresentable numbers
are cast to the minimum representable number (largest magnitude negative
number).</p>
<h3 id="apfloateq_2"><code>apfloat::eq_2</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">eq_2</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns <code>true</code> if <code>x == y</code>. Denormals are Zero (DAZ). Always returns <code>false</code> if
<code>x</code> or <code>y</code> is <code>NaN</code>.</p>
<h3 id="apfloatgt_2"><code>apfloat::gt_2</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">gt_2</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns <code>true</code> if <code>x &gt; y</code>. Denormals are Zero (DAZ). Always returns <code>false</code> if
<code>x</code> or <code>y</code> is <code>NaN</code>.</p>
<h3 id="apfloatgte_2"><code>apfloat::gte_2</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">gte_2</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">             </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">             </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns <code>true</code> if <code>x &gt;= y</code>. Denormals are Zero (DAZ). Always returns <code>false</code> if
<code>x</code> or <code>y</code> is <code>NaN</code>.</p>
<h3 id="apfloatlte_2"><code>apfloat::lte_2</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">lte_2</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">             </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">             </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns <code>true</code> if <code>x &lt;= y</code>. Denormals are Zero (DAZ). Always returns <code>false</code> if
<code>x</code> or <code>y</code> is <code>NaN</code>.</p>
<h3 id="apfloatlt_2"><code>apfloat::lt_2</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">lt_2</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">            </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u1</span>
</code></pre></div>
<p>Returns <code>true</code> if <code>x &lt; y</code>. Denormals are Zero (DAZ). Always returns <code>false</code> if
<code>x</code> or <code>y</code> is <code>NaN</code>.</p>
<h3 id="apfloatround_towards_zero"><code>apfloat::round_towards_zero</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">round_towards_zero</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>:<span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">                          </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns an <code>APFloat</code> with all its bits past the decimal point set to <code>0</code>.</p>
<h3 id="apfloatto_int"><code>apfloat::to_int</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">to_int</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">RESULT_SZ</span>:<span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">              </span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">sN</span><span class="p">[</span><span class="n">RESULT_SZ</span><span class="p">]</span>
</code></pre></div>
<p>Returns the signed integer part of the input float, truncating any fractional
bits if necessary.</p>
<h3 id="apfloataddsub"><code>apfloat::add/sub</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">add</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">sub</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns the sum/difference of <code>x</code> and <code>y</code> based on a generalization of IEEE 754
single-precision floating-point addition, with the following exceptions:</p>
<ul>
<li>Both input and output denormals are treated as/flushed to 0.</li>
<li>Only round-to-nearest mode is supported.</li>
<li>No exception flags are raised/reported.</li>
</ul>
<p>In all other cases, results should be identical to other conforming
implementations (modulo exact fraction values in the <code>NaN</code> case.</p>
<h4 id="implementation-details">Implementation details</h4>
<p>Floating-point addition, like any FP operation, is much more complicated than
integer addition, and has many more steps. Being the first operation described,
we'll take extra care to explain floating-point addition:</p>
<ol>
<li><strong>Expand fractions:</strong> Floating-point operations are computed with bits
    beyond that in their normal representations for increased precision. For
    IEEE 754 numbers, there are three extra, called the guard, rounding and
    sticky bits. The first two behave normally, but the last, the "sticky" bit,
    is special. During shift operations (below), if a "1" value is ever shifted
    into the sticky bit, it "sticks" - the bit will remain "1" through any
    further shift operations. In this step, the fractions are expanded by these
    three bits.</li>
<li><strong>Align fractions:</strong> To ensure that fractions are added with appropriate
    magnitudes, they must be aligned according to their exponents. To do so, the
    smaller significant needs to be shifted to the right (each right shift is
    equivalent to increasing the exponent by one).
    -   The extra precision bits are populated in this shift.
    -   As part of this step, the leading 1 bit... and a sign bit Note: The
        sticky bit is calculated and applied in this step.</li>
<li><strong>Sign-adjustment:</strong> if the fractions differ in sign, then the fraction with
    the smaller initial exponent needs to be (two's complement) negated.</li>
<li><strong>Add the fractions and capture the carry bit.</strong> Note that, if the signs of
    the fractions differs, then this could result in higher bits being cleared.</li>
<li><strong>Normalize the fractions:</strong> Shift the result so that the leading '1' is
    present in the proper space. This means shifting right one place if the
    result set the carry bit, and to the left some number of places if high bits
    were cleared.
    -   The sticky bit must be preserved in any of these shifts!</li>
<li><strong>Rounding:</strong> Here, the extra precision bits are examined to determine if
    the result fraction's last bit should be rounded up. IEEE 754 supports five
    rounding modes:
    -   Round towards 0: just chop off the extra precision bits.
    -   Round towards +infinity: round up if any extra precision bits are set.
    -   Round towards -infinity: round down if any extra precision bits are set.
    -   Round to nearest, ties away from zero: Rounds to the nearest value. In
        cases where the extra precision bits are halfway between values, i.e.,
        0b100, then the result is rounded up for positive numbers and down for
        negative ones.
    -   Round to nearest, ties to even: Rounds to the nearest value. In cases
        where the extra precision bits are halfway between values, then the
        result is rounded in whichever direction causes the LSB of the result
        significant to be 0.
        -   This is the most commonly-used rounding mode.
        -   This is [currently] the only supported mode by the DSLX
            implementation.</li>
<li><strong>Special case handling:</strong> The results are examined for special cases such
    as NaNs, infinities, or (optionally) subnormals.</li>
</ol>
<h5 id="result-sign-determination">Result sign determination</h5>
<p>The sign of the result will normally be the same as the sign of the operand with
the greater exponent, but there are two extra cases to consider. If the operands
have the same exponent, then the sign will be that of the greater fraction, and
if the result is 0, then we favor positive 0 vs. negative 0 (types are as for a
C <code>float</code> implementation):</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">addend_x</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">s29</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">addend_y</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">s29</span><span class="p">);</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">fraction_is_zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fraction</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">s29</span>:<span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">result_sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">fraction_is_zero</span><span class="p">,</span><span class="w"> </span><span class="n">fraction</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">s29</span>:<span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">u1</span>:<span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">greater_exp</span><span class="p">.</span><span class="n">sign</span><span class="p">,</span>
<span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">greater_exp</span><span class="p">.</span><span class="n">sign</span><span class="p">,</span>
<span class="w">  </span><span class="p">};</span>
</code></pre></div>
<h5 id="rounding">Rounding</h5>
<p>As complicated as rounding is to describe, its implementation is relatively
straightforward (types are as for a C <code>float</code> implementation):</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">normal_chunk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shifted_fraction</span><span class="p">[</span><span class="mi">0</span>:<span class="mi">3</span><span class="p">];</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">half_way_chunk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shifted_fraction</span><span class="p">[</span><span class="mi">2</span>:<span class="mi">4</span><span class="p">];</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">do_round_up</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">u1</span>:<span class="mi">1</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">normal_chunk</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">u3</span>:<span class="mh">0x4</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">half_way_chunk</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">u2</span>:<span class="mh">0x3</span><span class="p">)</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="n">u1</span>:<span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// We again need an extra bit for carry.</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">rounded_fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">shifted_fraction</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u28</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u28</span>:<span class="mh">0x8</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">do_round_up</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="n">shifted_fraction</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">u28</span><span class="p">);</span>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="n">rounding_carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rounded_fraction</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span>:<span class="p">];</span>
</code></pre></div>
<h3 id="apfloatmul"><code>apfloat::mul</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">mul</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">y</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span>
</code></pre></div>
<p>Returns the product of <code>x</code> and <code>y</code>, with the following exceptions:</p>
<ul>
<li>Both input and output denormals are treated as/flushed to 0.</li>
<li>Only round-to-nearest mode is supported.</li>
<li>No exception flags are raised/reported.</li>
</ul>
<p>In all other cases, results should be identical to other conforming
implementations (modulo exact fraction values in the NaN case).</p>
<h3 id="apfloatfma"><code>apfloat::fma</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fma</span><span class="o">&lt;</span><span class="n">EXP_SZ</span>: <span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span>: <span class="kt">u32</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">b</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">c</span>: <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="p">)</span>
<span class="w">    </span>-&gt; <span class="nc">APFloat</span><span class="o">&lt;</span><span class="n">EXP_SZ</span><span class="p">,</span><span class="w"> </span><span class="n">FRACTION_SZ</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</code></pre></div>
<p>Returns the Fused Multiply and Add (FMA) result of computing <code>a*b + c</code>.</p>
<p>The FMA operation is a three-operand operation that computes the product of the
first two and the sum of that with the third. The IEEE 754-2008 description of
the operation states that the operation should be performed "as if with
unbounded range and precision", limited only by rounding of the final result. In
other words, this differs from a sequence of a separate multiply followed by an
add in that there is only a single rounding step (instead of the two involved in
separate operations).</p>
<p>In practice, this means A) that the precision of an FMA is higher than
individual ops, and thus that B) an FMA requires significantly more internal
precision bits than naively expected.</p>
<p>For binary32 inputs, to achieve the standard-specified precision, the initial
mul requires the usual 48 ((23 fraction + 1 "hidden") * 2) fraction bits. When
performing the subsequent add step, though, it is necessary to maintain <em>72</em>
fraction bits ((23 fraction + 1 "hidden") * 3). Fortunately, this sum includes
the guard, round, and sticky bits (so we don't need 75). The mathematical
derivation of the exact amount will not be given here (as I've not done it), but
the same calculated size would apply for other data types (i.e., 54 * 2 = 108
and 54 * 3 = 162 for binary64).</p>
<p>Aside from determining the necessary precision bits, the FMA implementation is
rather straightforward, especially after reviewing the adder and multiplier.</p>
<h2 id="float64">float64</h2>
<p>To help with the <code>float64</code> or
<a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">double precision</a>
floating point numbers, <code>float32.x</code> defines the following type aliases.</p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">F64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apfloat</span>::<span class="n">APFloat</span><span class="o">&lt;</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">52</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">FloatTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apfloat</span>::<span class="n">APFloatTag</span><span class="p">;</span>
<span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">TaggedF64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FloatTag</span><span class="p">,</span><span class="w"> </span><span class="n">F64</span><span class="p">);</span>
</code></pre></div>
<p>Besides <code>float64</code> specializations of the functions in <code>apfloat.x</code>, the following
functions are defined just for <code>float64</code>.</p>
<h3 id="float64to_int64"><code>float64::to_int64</code></h3>
<p><div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">to_int64</span><span class="p">(</span><span class="n">x</span>: <span class="nc">F64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">s64</span><span class="p">;</span>
</code></pre></div>
Convert the the <code>F64</code> struct into a 64 bit integer.</p>
<h2 id="float32">float32</h2>
<p>To help with the <code>float32</code> or
<a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">single precision</a>
floating point numbers, <code>float32.x</code> defines the following type aliases.</p>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">F32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apfloat</span>::<span class="n">APFloat</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">FloatTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apfloat</span>::<span class="n">APFloatTag</span><span class="p">;</span>
<span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">TaggedF32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">FloatTag</span><span class="p">,</span><span class="w"> </span><span class="n">F32</span><span class="p">);</span>
<span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">F32_ONE_FLAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span>:<span class="mh">0x3f800000</span><span class="p">;</span>
</code></pre></div>
<p>Besides <code>float32</code> specializations of the functions in <code>apfloat.x</code>, the following
functions are defined just for <code>float32</code>.</p>
<h3 id="float32to_int32-float32from_int32"><code>float32::to_int32</code>, <code>float32::from_int32</code></h3>
<p><div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">to_int32</span><span class="p">(</span><span class="n">x</span>: <span class="nc">F32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">s32</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">from_int32</span><span class="p">(</span><span class="n">x</span>: <span class="nc">s32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">F32</span>
</code></pre></div>
Convert the <code>F32</code> struct to and from a 32bit integer.</p>
<h1 id="float32fixed_fraction"><code>float32::fixed_fraction</code></h1>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fixed_fraction</span><span class="p">(</span><span class="n">input_float</span>: <span class="nc">F32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">u23</span>
</code></pre></div>
<p>TBD</p>
<h1 id="float32fast_rsqrt_config_refinementsfloat32fast_rsqrt"><code>float32::fast_rsqrt_config_refinements</code>/<code>float32::fast_rsqrt</code></h1>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fast_rsqrt_config_refinements</span><span class="o">&lt;</span><span class="n">NUM_REFINEMENTS</span>: <span class="kt">u32</span> <span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="kt">u32</span>:<span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span>: <span class="nc">F32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">F32</span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">fast_rsqrt</span><span class="p">(</span><span class="n">x</span>: <span class="nc">F32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">F32</span>
</code></pre></div>
<p>Floating point (fast (approximate) inverse square root)[
https://en.wikipedia.org/wiki/Fast_inverse_square_root]. This should be able to
compute <code>1.0 / sqrt(x)</code> using fewer hardware resources than using a <code>sqrt</code> and
division module, although this hasn't been benchmarked yet. Latency is expected
to be lower as well. The tradeoff is that this offers slighlty less precision
(error is &lt; 0.2% in worst case). Note that:</p>
<ul>
<li>Input denormals are treated as/flushed to 0. (denormals-are-zero / DAZ).</li>
<li>Only round-to-nearest mode is supported.</li>
<li>No exception flags are raised/reported.</li>
<li>We emit a single, canonical representation for NaN (qnan) but accept
   all NaN respresentations as input.</li>
</ul>
<p><code>fast_rsqrt_config_refinements</code> allows the user to specify the number of
Computes an approximation of 1.0 / sqrt(x). <code>NUM_REFINEMENTS</code> can be increased
to tradeoff more hardware resources for more accuracy.</p>
<p><code>fast_rsqrt</code> does exactly one refinement.</p>
<h3 id="float32ldexp"><code>float32:ldexp</code></h3>
<p><code>`dslx-snippet
pub fn ldexp(fraction: F32, exp: s32) -&gt; F32
<div class="highlight"><pre><span></span><code>`ldexp` (load exponent) computes `fraction * 2^exp`. Note that:

 - Input denormals are treated as/flushed to 0. (denormals-are-zero / DAZ).  Similarly, denormal results are flushed to 0.
 - No exception flags are raised/reported.
 - We emit a single, canonical representation for NaN (qnan) but accept all `NaN` representations as input.


## bfloat16

To help with the
[`bfloat16`](https://en.wikipedia.org/wiki/Bfloat16_floating-point_format)
floating point numbers, `bfloat16.x` defines the following type aliases.

```dslx-snippet
pub type BF16 = apfloat::APFloat&lt;8, 7&gt;;
pub type FloatTag = apfloat::APFloatTag;
pub type TaggedBF16 = (FloatTag, BF16);
</code></pre></div>
Besides</code>bfloat16<code>specializations of the functions in</code>apfloat.x<code>, the following
functions are defined just for</code>bfloat16`.</p>
<h3 id="bfloat16to_int16"><code>bfloat16:to_int16</code></h3>
<p><div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">to_int16</span><span class="p">(</span><span class="n">x</span>: <span class="nc">BF16</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">s16</span>
</code></pre></div>
Convert the the <code>BF16</code> struct into a 16 bit integer.</p>
<h3 id="bfloat16increment_fraction"><code>bfloat16:increment_fraction</code></h3>
<div class="highlight"><pre><span></span><code><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">increment_fraction</span><span class="p">(</span><span class="n">input</span>: <span class="nc">BF16</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">BF16</span>
</code></pre></div>
<p>Increments the fraction of the input BF16 by one and returns the normalized
result. Input must be a normal <em>non-zero</em> number.</p>
<h2 id="testing">Testing</h2>
<p>Several different methods are used to test these routines, depending on
applicability. These are:</p>
<ul>
<li>Reference comparison: exhaustive testing</li>
<li>Reference comparison: space-sampling</li>
<li>Formal proving</li>
</ul>
<p>When comparing to a reference, a natural question is the stability of the
reference, i.e., is the reference answer the same across all versions or
environments? Will the answer given by glibc/libm on AArch64 be the same as one
given by a hardware FMA unit on a GPU? Fortunately, all "correct"
implementations will give the same results for the same inputs.* In addition,
POSIX has the same result-precision language. It's worth noting that -ffast-math
doesn't currently affect FMA emission/fusion/fission/etc.</p>
<p>* - There are operations for which this is not true. Transcendental ops may
differ between implementations due to the
<a href="https://en.wikipedia.org/wiki/Rounding"><em>table maker's dilemma</em></a>.</p>
<h3 id="exhaustive-testing">Exhaustive testing</h3>
<p>This is the happiest case - where the input space is so small that we can
iterate over every possible input, effectively treating the input as a binary
iteration counter. Sadly, this is uncommon (except, perhaps for ML math), as
binary32 is the precision floor for most problems, and a 64-bit input space is
well beyond our current abilities. Still - if your problem <em>can</em> be exhaustively
tested (with respect to a trusted reference), it <em>should</em> be exhaustively
tested!</p>
<p>None of our current ops are tested in this way, although the bf16 cases
could/should be.</p>
<h3 id="space-sampling">Space-sampling</h3>
<p>When the problem input space is too large for exhaustive testing, then random
samples can be tested instead. This approach can't give complete verification of
an implementation, but, given enough samples, it can yield a high degree of
confidence.</p>
<p>The existing modules are tested in this way. This could be improved by
preventing re-testing of any given sample (at the cost of memory and, perhaps,
atomic/locking costs) and by identifying interesting "corner cases" of the input
space and focusing on those.</p>
<h3 id="formal-verification">Formal verification</h3>
<p>This sort of testing utilizes our formal solver infrastructure to prove
correctness with the solver's internal FP implementation. This is fully
described in the
<a href="../solvers/">solvers documentation</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
    
  </body>
</html>